(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{AhPY:function(e,t,r){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(t){s(t)}}function i(e){try{c(a.throw(e))}catch(t){s(t)}}function c(e){e.done?n(e.value):new r((function(t){t(e.value)})).then(o,i)}c((a=a.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,a,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(i){s=[6,i],a=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("uf78"),i=r("+URC"),c=r("AxDN"),d=r("9va6"),u=r("WWJC"),l=r("xGtb"),h=r("SgkN"),m=r("6m6Q"),p=r("mLbz"),y=r("j9xR"),v=r("2aPM"),A=r("q+H0"),f=r("LOya"),g=r("AfLb"),_=function(){function e(e,t,r){void 0===t&&(t={}),this.gasPriceAddition=new v.BigNumber(3),this.gasIncreaseFactor=g.DEFAULT_GAS_INCREASE_FACTOR,t.networkName=t.networkName||h.Network.Main,t.gasPrice=t.gasPrice||m.makeBigNumber(3e5),this.api=new u.OpenSeaAPI(t),this._networkName=t.networkName;var a=new o.providers.HttpProvider(this._networkName==h.Network.Main?g.MAINNET_PROVIDER_URL:g.RINKEBY_PROVIDER_URL);this.web3=new o(e),this.web3ReadOnly=new o(a),this._wyvernProtocol=new i.WyvernProtocol(e,{network:this._networkName,gasPrice:t.gasPrice}),this._wyvernProtocolReadOnly=new i.WyvernProtocol(a,{network:this._networkName,gasPrice:t.gasPrice}),this._wrappedNFTFactoryAddress=this._networkName==h.Network.Main?g.WRAPPED_NFT_FACTORY_ADDRESS_MAINNET:g.WRAPPED_NFT_FACTORY_ADDRESS_RINKEBY,this._wrappedNFTLiquidationProxyAddress=this._networkName==h.Network.Main?g.WRAPPED_NFT_LIQUIDATION_PROXY_ADDRESS_MAINNET:g.WRAPPED_NFT_LIQUIDATION_PROXY_ADDRESS_RINKEBY,this._uniswapFactoryAddress=this._networkName==h.Network.Main?g.UNISWAP_FACTORY_ADDRESS_MAINNET:g.UNISWAP_FACTORY_ADDRESS_RINKEBY,this._emitter=new A.EventEmitter,this.logger=r||function(e){return e}}return e.prototype.addListener=function(e,t,r){return void 0===r&&(r=!1),r?this._emitter.once(e,t):this._emitter.addListener(e,t)},e.prototype.removeListener=function(e){e.remove()},e.prototype.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},e.prototype.wrapAssets=function(e){var t=e.assets,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o,i,c,d,u=this;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(h.WyvernSchemaName.ERC721),a=t.map((function(t){return m.getWyvernAsset(e,t)})),n=a.map((function(e){return e.id})),o=a.map((function(e){return e.address})),i=!o.every((function(e,t,r){return e===r[0]})),this._dispatch(h.EventType.WrapAssets,{assets:a,accountAddress:r}),[4,this._computeGasPrice()];case 1:return c=s.sent(),[4,m.sendRawTransaction(this.web3,{from:r,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:p.encodeCall(l.getMethod(l.WrappedNFTLiquidationProxy,"wrapNFTs"),[n,o,i]),gasPrice:c},(function(e){u._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 2:return d=s.sent(),[4,this._confirmTransaction(d,h.EventType.WrapAssets,"Wrapping Assets")];case 3:return s.sent(),[2]}}))}))},e.prototype.unwrapAssets=function(e){var t=e.assets,r=e.destinationAddresses,a=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u,y=this;return s(this,(function(s){switch(s.label){case 0:if(!t||!r||t.length!=r.length)throw new Error("The 'assets' and 'destinationAddresses' arrays must exist and have the same length.");return e=this._getSchema(h.WyvernSchemaName.ERC721),n=t.map((function(t){return m.getWyvernAsset(e,t)})),o=n.map((function(e){return e.id})),i=n.map((function(e){return e.address})),c=!i.every((function(e,t,r){return e===r[0]})),this._dispatch(h.EventType.UnwrapAssets,{assets:n,accountAddress:a}),[4,this._computeGasPrice()];case 1:return d=s.sent(),[4,m.sendRawTransaction(this.web3,{from:a,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:p.encodeCall(l.getMethod(l.WrappedNFTLiquidationProxy,"unwrapNFTs"),[o,i,r,c]),gasPrice:d},(function(e){y._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 2:return u=s.sent(),[4,this._confirmTransaction(u,h.EventType.UnwrapAssets,"Unwrapping Assets")];case 3:return s.sent(),[2]}}))}))},e.prototype.liquidateAssets=function(e){var t=e.assets,r=e.accountAddress,a=e.uniswapSlippageAllowedInBasisPoints;return n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u,y,v=this;return s(this,(function(s){switch(s.label){case 0:return e=0===a?g.DEFAULT_WRAPPED_NFT_LIQUIDATION_UNISWAP_SLIPPAGE_IN_BASIS_POINTS:a,n=this._getSchema(h.WyvernSchemaName.ERC721),o=t.map((function(e){return m.getWyvernAsset(n,e)})),i=o.map((function(e){return e.id})),c=o.map((function(e){return e.address})),d=!c.every((function(e,t,r){return e===r[0]})),this._dispatch(h.EventType.LiquidateAssets,{assets:o,accountAddress:r}),[4,this._computeGasPrice()];case 1:return u=s.sent(),[4,m.sendRawTransaction(this.web3,{from:r,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:p.encodeCall(l.getMethod(l.WrappedNFTLiquidationProxy,"liquidateNFTs"),[i,c,d,e]),gasPrice:u},(function(e){v._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 2:return y=s.sent(),[4,this._confirmTransaction(y,h.EventType.LiquidateAssets,"Liquidating Assets")];case 3:return s.sent(),[2]}}))}))},e.prototype.purchaseAssets=function(e){var t=e.numTokensToBuy,r=e.amount,a=e.contractAddress,o=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n,i=this;return s(this,(function(s){switch(s.label){case 0:return c.tokens[this._networkName].canonicalWrappedEther,this._dispatch(h.EventType.PurchaseAssets,{amount:r,contractAddress:a,accountAddress:o}),[4,this._computeGasPrice()];case 1:return e=s.sent(),[4,m.sendRawTransaction(this.web3,{from:o,to:this._wrappedNFTLiquidationProxyAddress,value:r,data:p.encodeCall(l.getMethod(l.WrappedNFTLiquidationProxy,"purchaseNFTs"),[t,a]),gasPrice:e},(function(e){i._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:o})}))];case 2:return n=s.sent(),[4,this._confirmTransaction(n,h.EventType.PurchaseAssets,"Purchasing Assets")];case 3:return s.sent(),[2]}}))}))},e.prototype.getQuoteFromUniswap=function(e){var t=e.numTokens,r=e.isBuying,a=e.contractAddress;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,h;return s(this,(function(s){switch(s.label){case 0:return[4,this.web3.eth.contract(l.WrappedNFTFactory).at(this._wrappedNFTFactoryAddress)];case 1:return[4,s.sent().nftContractToWrapperContract(a)];case 2:return e=s.sent(),[4,this.web3.eth.contract(l.WrappedNFT).at(e)];case 3:return n=s.sent(),[4,this.web3.eth.contract(l.UniswapFactory).at(this._uniswapFactoryAddress)];case 4:return[4,s.sent().getExchange(e)];case 5:return o=s.sent(),[4,this.web3.eth.contract(l.UniswapExchange).at(o)];case 6:return c=s.sent(),d=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(t),n.decimals()),r?(u=parseInt,[4,c.getEthToTokenOutputPrice(d)]):[3,8];case 7:return[2,u.apply(void 0,[s.sent()])];case 8:return h=parseInt,[4,c.getTokenToEthInputPrice(d)];case 9:return[2,h.apply(void 0,[s.sent()])]}}))}))},e.prototype.wrapEth=function(e){var t=e.amountInEth,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o,d=this;return s(this,(function(s){switch(s.label){case 0:return e=c.tokens[this._networkName].canonicalWrappedEther,a=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(t),e.decimals),this._dispatch(h.EventType.WrapEth,{accountAddress:r,amount:a}),[4,this._computeGasPrice()];case 1:return n=s.sent(),[4,m.sendRawTransaction(this.web3,{from:r,to:e.address,value:a,data:p.encodeCall(l.getMethod(l.CanonicalWETH,"deposit"),[]),gasPrice:n},(function(e){d._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 2:return o=s.sent(),[4,this._confirmTransaction(o,h.EventType.WrapEth,"Wrapping ETH")];case 3:return s.sent(),[2]}}))}))},e.prototype.unwrapWeth=function(e){var t=e.amountInEth,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o,d=this;return s(this,(function(s){switch(s.label){case 0:return e=c.tokens[this._networkName].canonicalWrappedEther,a=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(t),e.decimals),this._dispatch(h.EventType.UnwrapWeth,{accountAddress:r,amount:a}),[4,this._computeGasPrice()];case 1:return n=s.sent(),[4,m.sendRawTransaction(this.web3,{from:r,to:e.address,value:0,data:p.encodeCall(l.getMethod(l.CanonicalWETH,"withdraw"),[a.toString()]),gasPrice:n},(function(e){d._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 2:return o=s.sent(),[4,this._confirmTransaction(o,h.EventType.UnwrapWeth,"Unwrapping W-ETH")];case 3:return s.sent(),[2]}}))}))},e.prototype.createBundleBuyOrder=function(e){var t=e.assets,r=e.collection,o=e.quantities,i=e.accountAddress,d=e.startAmount,u=e.expirationTime,l=void 0===u?0:u,h=e.paymentTokenAddress,p=e.sellOrder,y=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,u,v,A;return s(this,(function(s){switch(s.label){case 0:return o=o||t.map((function(e){return 1})),h=h||c.tokens[this._networkName].canonicalWrappedEther.address,[4,this._makeBundleBuyOrder({assets:t,collection:r,quantities:o,accountAddress:i,startAmount:d,expirationTime:l,paymentTokenAddress:h,extraBountyBasisPoints:0,sellOrder:p,referrerAddress:y})];case 1:return e=s.sent(),[4,this._buyOrderValidationAndApprovals({order:e,accountAddress:i})];case 2:s.sent(),n=a({},e,{hash:m.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return u=s.sent(),[3,6];case 5:throw v=s.sent(),console.error(v),new Error("You declined to authorize your offer");case 6:return A=a({},n,u),[2,this.validateAndPostOrder(A)]}}))}))},e.prototype.createBuyOrder=function(e){var t=e.asset,r=e.accountAddress,o=e.startAmount,i=e.quantity,d=void 0===i?1:i,u=e.expirationTime,l=void 0===u?0:u,h=e.paymentTokenAddress,p=e.sellOrder,y=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,i,u,v;return s(this,(function(s){switch(s.label){case 0:return h=h||c.tokens[this._networkName].canonicalWrappedEther.address,[4,this._makeBuyOrder({asset:t,quantity:d,accountAddress:r,startAmount:o,expirationTime:l,paymentTokenAddress:h,extraBountyBasisPoints:0,sellOrder:p,referrerAddress:y})];case 1:return e=s.sent(),[4,this._buyOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:s.sent(),n=a({},e,{hash:m.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return i=s.sent(),[3,6];case 5:throw u=s.sent(),console.error(u),new Error("You declined to authorize your offer");case 6:return v=a({},n,i),[2,this.validateAndPostOrder(v)]}}))}))},e.prototype.createSellOrder=function(e){var t=e.asset,r=e.accountAddress,o=e.startAmount,i=e.endAmount,c=e.quantity,d=void 0===c?1:c,u=e.listingTime,l=e.expirationTime,h=void 0===l?0:l,p=e.waitForHighestBid,y=void 0!==p&&p,v=e.englishAuctionReservePrice,A=e.paymentTokenAddress,f=e.extraBountyBasisPoints,_=void 0===f?0:f,w=e.buyerAddress,T=e.buyerEmail;return n(this,void 0,void 0,(function(){var e,n,c,l,p;return s(this,(function(s){switch(s.label){case 0:return[4,this._makeSellOrder({asset:t,quantity:d,accountAddress:r,startAmount:o,endAmount:i,listingTime:u,expirationTime:h,waitForHighestBid:y,englishAuctionReservePrice:v,paymentTokenAddress:A||g.NULL_ADDRESS,extraBountyBasisPoints:_,buyerAddress:w||g.NULL_ADDRESS})];case 1:return e=s.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:return s.sent(),T?[4,this._createEmailWhitelistEntry({order:e,buyerEmail:T})]:[3,4];case 3:s.sent(),s.label=4;case 4:n=a({},e,{hash:m.getOrderHash(e)}),s.label=5;case 5:return s.trys.push([5,7,,8]),[4,this._authorizeOrder(n)];case 6:return c=s.sent(),[3,8];case 7:throw l=s.sent(),console.error(l),new Error("You declined to authorize your auction");case 8:return p=a({},n,c),[2,this.validateAndPostOrder(p)]}}))}))},e.prototype.createFactorySellOrders=function(e){var t=e.assets,r=e.accountAddress,o=e.startAmount,i=e.endAmount,c=e.quantity,u=void 0===c?1:c,l=e.listingTime,h=e.expirationTime,p=void 0===h?0:h,y=e.waitForHighestBid,v=void 0!==y&&y,A=e.paymentTokenAddress,f=e.extraBountyBasisPoints,_=void 0===f?0:f,w=e.buyerAddress,T=e.buyerEmail,k=e.numberOfOrders,P=void 0===k?1:k;return n(this,void 0,void 0,(function(){var e,c,h,y,f,k,E,b,S,N=this;return s(this,(function(F){switch(F.label){case 0:if(P<1)throw new Error("Need to make at least one sell order");if(!t||!t.length)throw new Error("Need at least one asset to create orders for");if(1!==d.uniqBy(t,(function(e){return e.tokenAddress})).length)throw new Error("All assets must be on the same factory contract address");return[4,this._makeSellOrder({asset:t[0],quantity:u,accountAddress:r,startAmount:o,endAmount:i,listingTime:l,expirationTime:p,waitForHighestBid:v,paymentTokenAddress:A||g.NULL_ADDRESS,extraBountyBasisPoints:_,buyerAddress:w||g.NULL_ADDRESS})];case 1:return e=F.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:F.sent(),c=function(e){return n(N,void 0,void 0,(function(){var t,n,c,d,h;return s(this,(function(s){switch(s.label){case 0:return[4,this._makeSellOrder({asset:e,quantity:u,accountAddress:r,startAmount:o,endAmount:i,listingTime:l,expirationTime:p,waitForHighestBid:v,paymentTokenAddress:A||g.NULL_ADDRESS,extraBountyBasisPoints:_,buyerAddress:w||g.NULL_ADDRESS})];case 1:return t=s.sent(),T?[4,this._createEmailWhitelistEntry({order:t,buyerEmail:T})]:[3,3];case 2:s.sent(),s.label=3;case 3:n=a({},t,{hash:m.getOrderHash(t)}),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,this._authorizeOrder(n)];case 5:return c=s.sent(),[3,7];case 6:throw d=s.sent(),console.error(d),new Error("You declined to authorize your auction, or your web3 provider can't sign using personal_sign. Try 'web3-provider-engine' and make sure a mnemonic is set. Just a reminder: there's no gas needed anymore to mint tokens!");case 7:return h=a({},n,c),[2,this.validateAndPostOrder(h)]}}))}))},h=d.range(P*t.length),y=d.chunk(h,g.SELL_ORDER_BATCH_SIZE),f=0,k=0,E=y,F.label=3;case 3:return k<E.length?(b=E[k],[4,Promise.all(b.map((function(e){return n(N,void 0,void 0,(function(){var r;return s(this,(function(a){return r=Math.floor(e/P),[2,c(t[r])]}))}))})))]):[3,7];case 4:return S=F.sent(),this.logger("Created and posted a batch of "+S.length+" orders in parallel."),f+=S.length,[4,m.delay(500)];case 5:F.sent(),F.label=6;case 6:return k++,[3,3];case 7:return[2,f]}}))}))},e.prototype.createBundleSellOrder=function(e){var t=e.bundleName,r=e.bundleDescription,o=e.bundleExternalLink,i=e.assets,c=e.collection,d=e.quantities,u=e.accountAddress,l=e.startAmount,h=e.endAmount,p=e.expirationTime,y=void 0===p?0:p,v=e.listingTime,A=e.waitForHighestBid,f=void 0!==A&&A,_=e.englishAuctionReservePrice,w=e.paymentTokenAddress,T=e.extraBountyBasisPoints,k=void 0===T?0:T,P=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,p,A,T;return s(this,(function(s){switch(s.label){case 0:return d=d||i.map((function(e){return 1})),[4,this._makeBundleSellOrder({bundleName:t,bundleDescription:r,bundleExternalLink:o,assets:i,collection:c,quantities:d,accountAddress:u,startAmount:l,endAmount:h,listingTime:v,expirationTime:y,waitForHighestBid:f,englishAuctionReservePrice:_,paymentTokenAddress:w||g.NULL_ADDRESS,extraBountyBasisPoints:k,buyerAddress:P||g.NULL_ADDRESS})];case 1:return e=s.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:u})];case 2:s.sent(),n=a({},e,{hash:m.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return p=s.sent(),[3,6];case 5:throw A=s.sent(),console.error(A),new Error("You declined to authorize your auction");case 6:return T=a({},n,p),[2,this.validateAndPostOrder(T)]}}))}))},e.prototype.fulfillOrder=function(e){var t=e.order,r=e.accountAddress,a=e.recipientAddress,o=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,i,c,d,u,l,p=this;return s(this,(function(y){switch(y.label){case 0:return e=this._makeMatchingOrder({order:t,accountAddress:r,recipientAddress:a||r}),i=m.assignOrdersToSides(t,e),c=i.buy,d=i.sell,u=this._getMetadata(t,o),[4,this._atomicMatch({buy:c,sell:d,accountAddress:r,metadata:u})];case 1:return l=y.sent(),[4,this._confirmTransaction(l,h.EventType.MatchOrders,"Fulfilling order",(function(){return n(p,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._validateOrder(t)];case 1:return[2,!e.sent()]}}))}))}))];case 2:return y.sent(),[2,l]}}))}))},e.prototype.cancelOrder=function(e){var t=e.order,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,o=this;return s(this,(function(i){switch(i.label){case 0:return this._dispatch(h.EventType.CancelOrder,{order:t,accountAddress:r}),[4,this._computeGasPrice()];case 1:return e=i.sent(),[4,this._wyvernProtocol.wyvernExchange.cancelOrder_.sendTransactionAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,t.v||0,t.r||g.NULL_BLOCK_HASH,t.s||g.NULL_BLOCK_HASH,{from:r,gasPrice:e})];case 2:return a=i.sent(),[4,this._confirmTransaction(a.toString(),h.EventType.CancelOrder,"Cancelling order",(function(){return n(o,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._validateOrder(t)];case 1:return[2,!e.sent()]}}))}))}))];case 3:return i.sent(),[2]}}))}))},e.prototype.approveSemiOrNonFungibleToken=function(e){var t=e.tokenId,r=e.tokenAddress,a=e.accountAddress,o=e.proxyAddress,i=e.tokenAbi,c=void 0===i?l.ERC721:i,d=e.skipApproveAllIfTokenAddressIn,u=void 0===d?new Set:d,p=e.schemaName,y=void 0===p?h.WyvernSchemaName.ERC721:p;return n(this,void 0,void 0,(function(){var e,i,d,l,p,v,A,f,g,_=this;return s(this,(function(w){switch(w.label){case 0:return e=this._getSchema(y),[4,this.web3.eth.contract(c).at(r)];case 1:return i=w.sent(),o?[3,3]:[4,this._getProxy(a)];case 2:if(!(o=w.sent()||void 0))throw new Error("Uninitialized account");w.label=3;case 3:return[4,(d=function(){return n(_,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,m.rawCall(this.web3ReadOnly,{from:a,to:i.address,data:i.isApprovedForAll.getData(a,o)})];case 1:return e=t.sent(),[2,parseInt(e)]}}))}))})()];case 4:if(1==(l=w.sent()))return this.logger("Already approved proxy for all tokens"),[2,null];if(0!=l)return[3,10];if(u.has(r))return this.logger("Already approving proxy for all tokens in another transaction"),[2,null];u.add(r),w.label=5;case 5:return w.trys.push([5,9,,10]),this._dispatch(h.EventType.ApproveAllAssets,{accountAddress:a,proxyAddress:o,contractAddress:r}),[4,this._computeGasPrice()];case 6:return A=w.sent(),[4,m.sendRawTransaction(this.web3,{from:a,to:i.address,data:i.setApprovalForAll.getData(o,!0),gasPrice:A},(function(e){_._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 7:return f=w.sent(),[4,this._confirmTransaction(f,h.EventType.ApproveAllAssets,"Approving all tokens of this type for trading",(function(){return n(_,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,d()];case 1:return[2,1==e.sent()]}}))}))}))];case 8:return w.sent(),[2,f];case 9:throw p=w.sent(),console.error(p),new Error("Couldn't get permission to approve these tokens for trading. Their contract might not be implemented correctly. Please contact the developer!");case 10:return this.logger("Contract does not support Approve All"),[4,(v=function(){return n(_,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return[4,m.promisifyCall((function(e){return i.getApproved.call(t,e)}))];case 1:return(e=r.sent())==o?(this.logger("Already approved proxy for this token"),[2,!0]):(this.logger("Approve response: "+e),e?[3,3]:[4,m.getNonCompliantApprovalAddress(i,t,a)]);case 2:if((e=r.sent())==o)return this.logger("Already approved proxy for this item"),[2,!0];this.logger("Special-case approve response: "+e),r.label=3;case 3:return[2,!1]}}))}))})()];case 11:if(w.sent())return[2,null];w.label=12;case 12:return w.trys.push([12,16,,17]),this._dispatch(h.EventType.ApproveAsset,{accountAddress:a,proxyAddress:o,asset:m.getWyvernAsset(e,{tokenId:t,tokenAddress:r})}),[4,this._computeGasPrice()];case 13:return A=w.sent(),[4,m.sendRawTransaction(this.web3,{from:a,to:i.address,data:i.approve.getData(o,t),gasPrice:A},(function(e){_._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 14:return f=w.sent(),[4,this._confirmTransaction(f,h.EventType.ApproveAsset,"Approving single token for trading",v)];case 15:return w.sent(),[2,f];case 16:throw g=w.sent(),console.error(g),new Error("Couldn't get permission to approve this token for trading. Its contract might not be implemented correctly. Please contact the developer!");case 17:return[2]}}))}))},e.prototype.approveFungibleToken=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress,o=e.minimumAmount,c=void 0===o?i.WyvernProtocol.MAX_UINT_256:o;return n(this,void 0,void 0,(function(){var e,o,d,u,y=this;return s(this,(function(v){switch(v.label){case 0:return a=a||i.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return(e=v.sent()).greaterThanOrEqualTo(c)?(this.logger("Already approved enough currency for trading"),[2,null]):(this.logger("Not enough token approved for trade: "+e+" approved to transfer "+r),this._dispatch(h.EventType.ApproveCurrency,{accountAddress:t,contractAddress:r,proxyAddress:a}),o=[g.ENJIN_COIN_ADDRESS,g.MANA_ADDRESS].includes(r.toLowerCase()),c.greaterThan(0)&&o?[4,this.unapproveFungibleToken({accountAddress:t,tokenAddress:r,proxyAddress:a})]:[3,3]);case 2:v.sent(),v.label=3;case 3:return[4,this._computeGasPrice()];case 4:return d=v.sent(),[4,m.sendRawTransaction(this.web3,{from:t,to:r,data:p.encodeCall(l.getMethod(l.ERC20,"approve"),[a,i.WyvernProtocol.MAX_UINT_256.toString()]),gasPrice:d},(function(e){y._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 5:return u=v.sent(),[4,this._confirmTransaction(u,h.EventType.ApproveCurrency,"Approving currency for trading",(function(){return n(y,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return[2,e.sent().greaterThanOrEqualTo(c)]}}))}))}))];case 6:return v.sent(),[2,u]}}))}))},e.prototype.unapproveFungibleToken=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,o,c=this;return s(this,(function(d){switch(d.label){case 0:return a=a||i.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,this._computeGasPrice()];case 1:return e=d.sent(),[4,m.sendRawTransaction(this.web3,{from:t,to:r,data:p.encodeCall(l.getMethod(l.ERC20,"approve"),[a,0]),gasPrice:e},(function(e){c._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 2:return o=d.sent(),[4,this._confirmTransaction(o,h.EventType.UnapproveCurrency,"Resetting Currency Approval",(function(){return n(c,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return[2,e.sent().isZero()]}}))}))}))];case 3:return d.sent(),[2,o]}}))}))},e.prototype.getCurrentPrice=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.calculateCurrentPrice_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata)];case 1:return[2,t.sent()]}}))}))},e.prototype.isOrderFulfillable=function(e){var t=e.order,r=e.accountAddress,a=e.recipientAddress,o=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:return e=this._makeMatchingOrder({order:t,accountAddress:r,recipientAddress:a||r}),n=m.assignOrdersToSides(t,e),i=n.buy,c=n.sell,d=this._getMetadata(t,o),[4,this._estimateGasForMatch({buy:i,sell:c,accountAddress:r,metadata:d})];case 1:return u=s.sent(),this.logger("Gas estimate for "+(t.side==h.OrderSide.Sell?"sell":"buy")+" order: "+u),[2,null!=u&&u>0]}}))}))},e.prototype.isAssetTransferrable=function(e,t){var r=e.asset,a=e.fromAddress,o=e.toAddress,c=e.quantity,d=e.useProxy,u=void 0!==d&&d;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,d,l,h,y,v,A;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(r.schemaName),n=c?i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(c),r.decimals||0):m.makeBigNumber(1),d=m.getWyvernAsset(e,r,n),l=e.functions.transfer(d),h=a,u?[4,this._getProxy(a)]:[3,2];case 1:if(!(y=s.sent()))return console.error("This asset's owner ("+a+") does not have a proxy!"),[2,!1];h=y,s.label=2;case 2:v=p.encodeTransferCall(l,a,o),s.label=3;case 3:return s.trys.push([3,5,,8]),[4,m.estimateGas(this._getClientsForRead(t).web3,{from:h,to:l.target,data:v})];case 4:return[2,s.sent()>0];case 5:return A=s.sent(),t<=0?(console.error(A),console.error(h,l.target,v),[2,!1]):[4,m.delay(500)];case 6:return s.sent(),[4,this.isAssetTransferrable({asset:r,fromAddress:a,toAddress:o,quantity:c,useProxy:u},t-1)];case 7:return[2,s.sent()];case 8:return[2]}}))}))},e.prototype.transfer=function(e){var t=e.fromAddress,r=e.toAddress,a=e.asset,o=e.quantity,c=void 0===o?1:o;return n(this,void 0,void 0,(function(){var e,n,o,d,u,l,y,v,A,f=this;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(a.schemaName),n=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(c),a.decimals||0),o=m.getWyvernAsset(e,a,n),d=[g.CK_ADDRESS,g.CK_RINKEBY_ADDRESS].includes(o.address),u=d||!!a.version&&[h.TokenStandardVersion.ERC721v1,h.TokenStandardVersion.ERC721v2].includes(a.version),l=a.schemaName===h.WyvernSchemaName.ERC20?m.annotateERC20TransferABI(o):u?m.annotateERC721TransferABI(o):e.functions.transfer(o),this._dispatch(h.EventType.TransferOne,{accountAddress:t,toAddress:r,asset:o}),[4,this._computeGasPrice()];case 1:return y=s.sent(),v=p.encodeTransferCall(l,t,r),[4,m.sendRawTransaction(this.web3,{from:t,to:l.target,data:v,gasPrice:y},(function(e){f._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 2:return A=s.sent(),[4,this._confirmTransaction(A,h.EventType.TransferOne,"Transferring asset")];case 3:return s.sent(),[2,A]}}))}))},e.prototype.transferAll=function(e){var t=e.assets,r=e.fromAddress,a=e.toAddress,o=e.schemaName,i=void 0===o?h.WyvernSchemaName.ERC721:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,y,v=this;return s(this,(function(s){switch(s.label){case 0:return a=m.validateAndFormatWalletAddress(this.web3,a),e=t.map((function(e){return e.schemaName||i})),n=t.map((function(e){return m.getWyvernAsset(v._getSchema(e.schemaName),e)})),o=p.encodeAtomicizedTransfer(e.map((function(e){return v._getSchema(e)})),n,r,a,this._wyvernProtocol,this._networkName),c=o.calldata,d=o.target,[4,this._getProxy(r)];case 1:return(u=s.sent())?[3,3]:[4,this._initializeProxy(r)];case 2:u=s.sent(),s.label=3;case 3:return[4,this._approveAll({schemaNames:e,wyAssets:n,accountAddress:r,proxyAddress:u})];case 4:return s.sent(),this._dispatch(h.EventType.TransferAll,{accountAddress:r,toAddress:a,assets:n}),[4,this._computeGasPrice()];case 5:return l=s.sent(),[4,m.sendRawTransaction(this.web3,{from:r,to:u,data:p.encodeProxyCall(d,h.HowToCall.DelegateCall,c),gasPrice:l},(function(e){v._dispatch(h.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 6:return y=s.sent(),[4,this._confirmTransaction(y,h.EventType.TransferAll,"Transferring "+t.length+" asset"+(1==t.length?"":"s"))];case 7:return s.sent(),[2,y]}}))}))},e.prototype.getFungibleTokens=function(e){var t=void 0===e?{}:e,r=t.symbol,a=t.address,o=t.name;return n(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return m.onDeprecated("Use `api.getPaymentTokens` instead"),e=c.tokens[this._networkName],[4,this.api.getPaymentTokens({symbol:r,address:a,name:o})];case 1:return t=n.sent().tokens,[2,[e.canonicalWrappedEther].concat(e.otherTokens).filter((function(e){return(null==r||e.symbol.toLowerCase()==r.toLowerCase())&&((null==a||e.address.toLowerCase()==a.toLowerCase())&&(null==o||e.name==o))})).concat(t)]}}))}))},e.prototype.getAssetBalance=function(e,t){var r=e.accountAddress,a=e.asset;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u,l,h,p;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(a.schemaName),n=m.getWyvernAsset(e,a),e.functions.countOf?(o=e.functions.countOf(n),i=this._getClientsForRead(t).web3.eth.contract([o]).at(o.target),c=o.inputs.filter((function(e){return void 0!==e.value})).map((function(e){return e.value})),[4,m.promisifyCall((function(e){var t;return(t=i[o.name]).call.apply(t,[r].concat(c,[e]))}))]):[3,2];case 1:return void 0!==(d=s.sent())?[2,d]:[3,5];case 2:if(!e.functions.ownerOf)return[3,4];if(u=e.functions.ownerOf(n),l=this._getClientsForRead(t).web3.eth.contract([u]).at(u.target),u.inputs.filter((function(e){return void 0===e.value}))[0])throw new Error("Missing an argument for finding the owner of this asset");return h=u.inputs.map((function(e){return e.value.toString()})),[4,m.promisifyCall((function(e){var t;return(t=l[u.name]).call.apply(t,h.concat([e]))}))];case 3:return(p=s.sent())?[2,p.toLowerCase()==r.toLowerCase()?new v.BigNumber(1):new v.BigNumber(0)]:[3,5];case 4:throw new Error("Missing ownership schema for this asset type");case 5:if(!(t<=0))return[3,6];throw new Error("Unable to get current owner from smart contract");case 6:return[4,m.delay(500)];case 7:return s.sent(),[4,this.getAssetBalance({accountAddress:r,asset:a},t-1)];case 8:return[2,s.sent()]}}))}))},e.prototype.getTokenBalance=function(e,t){var r=e.accountAddress,a=e.tokenAddress,o=e.schemaName,i=void 0===o?h.WyvernSchemaName.ERC20:o;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e;return s(this,(function(n){return e={tokenId:null,tokenAddress:a,schemaName:i},[2,this.getAssetBalance({accountAddress:r,asset:e},t)]}))}))},e.prototype.computeFees=function(e){var t=e.asset,r=e.side,a=e.accountAddress,o=e.isPrivate,i=void 0!==o&&o,c=e.extraBountyBasisPoints,d=void 0===c?0:c;return n(this,void 0,void 0,(function(){var e,n,o,c,u,l,p,y,v,A,f,_;return s(this,(function(s){switch(s.label){case 0:if(e=g.DEFAULT_BUYER_FEE_BASIS_POINTS,n=g.DEFAULT_SELLER_FEE_BASIS_POINTS,o=0,c=0,u=m.makeBigNumber(0),l=null,p=g.DEFAULT_MAX_BOUNTY,t&&(e=+t.collection.openseaBuyerFeeBasisPoints,n=+t.collection.openseaSellerFeeBasisPoints,o=+t.collection.devBuyerFeeBasisPoints,c=+t.collection.devSellerFeeBasisPoints,p=n),r!=h.OrderSide.Sell||!t)return[3,4];u=t.transferFee?m.makeBigNumber(t.transferFee):u,l=t.transferFeePaymentToken?t.transferFeePaymentToken.address:l,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,m.getTransferFeeSettings(this.web3,{asset:t,accountAddress:a})];case 2:return y=s.sent(),u=null!=y.transferFee?y.transferFee:u,l=y.transferFeeTokenAddress||l,[3,4];case 3:return v=s.sent(),console.error(v),[3,4];case 4:if(A=r==h.OrderSide.Sell?d:0,f=A+g.OPENSEA_SELLER_BOUNTY_BASIS_POINTS>p,A>0&&f)throw _="Total bounty exceeds the maximum for this asset type ("+p/100+"%).",p>=g.OPENSEA_SELLER_BOUNTY_BASIS_POINTS&&(_+=" Remember that OpenSea will add "+g.OPENSEA_SELLER_BOUNTY_BASIS_POINTS/100+"% for referrers with OpenSea accounts!"),new Error(_);return i&&(e=0,n=0,o=0,c=0,A=0),[2,{totalBuyerFeeBasisPoints:e+o,totalSellerFeeBasisPoints:n+c,openseaBuyerFeeBasisPoints:e,openseaSellerFeeBasisPoints:n,devBuyerFeeBasisPoints:o,devSellerFeeBasisPoints:c,sellerBountyBasisPoints:A,transferFee:u,transferFeeTokenAddress:l}]}}))}))},e.prototype.validateAndPostOrder=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.hashOrder_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata)];case 1:if(t.sent()!==e.hash)throw console.error(e),new Error("Order couldn't be validated by the exchange due to a hash mismatch. Make sure your wallet is on the right network!");return this.logger("Order hashes match"),[4,this.api.postOrder(m.orderToJSON(e))];case 2:return[2,t.sent()]}}))}))},e.prototype._computeGasPrice=function(){return n(this,void 0,void 0,(function(){var e,t;return s(this,(function(r){switch(r.label){case 0:return[4,m.getCurrentGasPrice(this.web3)];case 1:return e=r.sent(),t=this.web3.toWei(this.gasPriceAddition,"gwei"),[2,e.plus(t)]}}))}))},e.prototype._correctGasAmount=function(e){return Math.ceil(e*this.gasIncreaseFactor)},e.prototype._estimateGasForMatch=function(e,t){var r=e.buy,a=e.sell,o=e.accountAddress,i=e.metadata,c=void 0===i?g.NULL_BLOCK_HASH:i;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n;return s(this,(function(s){switch(s.label){case 0:return r.maker.toLowerCase()!=o.toLowerCase()||r.paymentToken!=g.NULL_ADDRESS?[3,2]:[4,this._getRequiredAmountForTakingSellOrder(a)];case 1:e=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,7]),[4,this._getClientsForRead(t).wyvernProtocol.wyvernExchange.atomicMatch_.estimateGasAsync([r.exchange,r.maker,r.taker,r.feeRecipient,r.target,r.staticTarget,r.paymentToken,a.exchange,a.maker,a.taker,a.feeRecipient,a.target,a.staticTarget,a.paymentToken],[r.makerRelayerFee,r.takerRelayerFee,r.makerProtocolFee,r.takerProtocolFee,r.basePrice,r.extra,r.listingTime,r.expirationTime,r.salt,a.makerRelayerFee,a.takerRelayerFee,a.makerProtocolFee,a.takerProtocolFee,a.basePrice,a.extra,a.listingTime,a.expirationTime,a.salt],[r.feeMethod,r.side,r.saleKind,r.howToCall,a.feeMethod,a.side,a.saleKind,a.howToCall],r.calldata,a.calldata,r.replacementPattern,a.replacementPattern,r.staticExtradata,a.staticExtradata,[r.v||0,a.v||0],[r.r||g.NULL_BLOCK_HASH,r.s||g.NULL_BLOCK_HASH,a.r||g.NULL_BLOCK_HASH,a.s||g.NULL_BLOCK_HASH,c],{from:o,value:e})];case 3:return[2,s.sent()];case 4:return n=s.sent(),t<=0?(console.error(n),[2,void 0]):[4,m.delay(200)];case 5:return s.sent(),[4,this._estimateGasForMatch({buy:r,sell:a,accountAddress:o,metadata:c},t-1)];case 6:return[2,s.sent()];case 7:return[2]}}))}))},e.prototype._estimateGasForTransfer=function(e){var t=e.assets,r=e.fromAddress,a=e.toAddress,o=e.schemaName,i=void 0===o?h.WyvernSchemaName.ERC721:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l=this;return s(this,(function(s){switch(s.label){case 0:return e=t.map((function(e){return e.schemaName||i})),n=t.map((function(e){return m.getWyvernAsset(l._getSchema(e.schemaName),e)})),[4,this._getProxy(r)];case 1:if(!(o=s.sent()))throw new Error("Uninitialized proxy address");return[4,this._approveAll({schemaNames:e,wyAssets:n,accountAddress:r,proxyAddress:o})];case 2:return s.sent(),c=p.encodeAtomicizedTransfer(e.map((function(e){return l._getSchema(e)})),n,r,a,this._wyvernProtocol,this._networkName),d=c.calldata,u=c.target,[2,m.estimateGas(this.web3,{from:r,to:o,data:p.encodeProxyCall(u,h.HowToCall.DelegateCall,d)})]}}))}))},e.prototype._getProxy=function(e,t){return void 0===t&&(t=0),n(this,void 0,void 0,(function(){var r;return s(this,(function(a){switch(a.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernProxyRegistry.proxies.callAsync(e)];case 1:if("0x"==(r=a.sent()))throw new Error("Couldn't retrieve your account from the blockchain - make sure you're on the correct Ethereum network!");return r&&r!=g.NULL_ADDRESS?[3,5]:t>0?[4,m.delay(1e3)]:[3,4];case 2:return a.sent(),[4,this._getProxy(e,t-1)];case 3:return[2,a.sent()];case 4:r=null,a.label=5;case 5:return[2,r]}}))}))},e.prototype._initializeProxy=function(e){return n(this,void 0,void 0,(function(){var t,r,o,i,c,d=this;return s(this,(function(u){switch(u.label){case 0:return this._dispatch(h.EventType.InitializeAccount,{accountAddress:e}),this.logger("Initializing proxy for account: "+e),[4,this._computeGasPrice()];case 1:return t=u.sent(),r={from:e},[4,this._wyvernProtocolReadOnly.wyvernProxyRegistry.registerProxy.estimateGasAsync(r)];case 2:return o=u.sent(),[4,this._wyvernProtocol.wyvernProxyRegistry.registerProxy.sendTransactionAsync(a({},r,{gasPrice:t,gas:this._correctGasAmount(o)}))];case 3:return i=u.sent(),[4,this._confirmTransaction(i,h.EventType.InitializeAccount,"Initializing proxy for account",(function(){return n(d,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._getProxy(e)];case 1:return[2,!!t.sent()]}}))}))}))];case 4:return u.sent(),[4,this._getProxy(e,2)];case 5:if(!(c=u.sent()))throw new Error("Failed to initialize your account :( Please restart your wallet/browser and try again!");return[2,c]}}))}))},e.prototype._getApprovedTokenCount=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,n;return s(this,(function(s){switch(s.label){case 0:return r||(r=c.tokens[this._networkName].canonicalWrappedEther.address),e=a||i.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,m.rawCall(this.web3,{from:t,to:r,data:p.encodeCall(l.getMethod(l.ERC20,"allowance"),[t,e])})];case 1:return n=s.sent(),[2,m.makeBigNumber(n)]}}))}))},e.prototype._makeBuyOrder=function(e){var t=e.asset,r=e.quantity,a=e.accountAddress,o=e.startAmount,c=e.expirationTime,d=void 0===c?0:c,u=e.paymentTokenAddress,l=e.extraBountyBasisPoints,y=void 0===l?0:l,v=e.sellOrder,A=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,c,l,f,_,w,T,k,P,E,b,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q;return s(this,(function(s){switch(s.label){case 0:return a=m.validateAndFormatWalletAddress(this.web3,a),e=this._getSchema(t.schemaName),n=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(r),t.decimals||0),c=m.getWyvernAsset(e,t,n),[4,this.api.getAsset(t)];case 1:return l=s.sent(),f=v?v.maker:g.NULL_ADDRESS,[4,this.computeFees({asset:l,extraBountyBasisPoints:y,side:h.OrderSide.Buy})];case 2:return _=s.sent(),w=_.totalBuyerFeeBasisPoints,T=_.totalSellerFeeBasisPoints,k=this._getBuyFeeParameters(w,T,v),P=k.makerRelayerFee,E=k.takerRelayerFee,b=k.makerProtocolFee,S=k.takerProtocolFee,N=k.makerReferrerFee,F=k.feeRecipient,R=k.feeMethod,B=p.encodeBuy(e,c,a),x=B.target,C=B.calldata,O=B.replacementPattern,[4,this._getPriceParameters(h.OrderSide.Buy,u,d,o)];case 3:return L=s.sent(),D=L.basePrice,I=L.extra,W=L.paymentToken,M=this._getTimeParameters(d),[4,this._getStaticCallTargetAndExtraData({asset:l,useTxnOriginStaticCall:!1})];case 4:return U=s.sent(),H=U.staticTarget,q=U.staticExtradata,[2,{exchange:i.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:a,taker:f,quantity:n,makerRelayerFee:P,takerRelayerFee:E,makerProtocolFee:b,takerProtocolFee:S,makerReferrerFee:N,waitingForBestCounterOrder:!1,feeMethod:R,feeRecipient:F,side:h.OrderSide.Buy,saleKind:h.SaleKind.FixedPrice,target:x,howToCall:h.HowToCall.Call,calldata:C,replacementPattern:O,staticTarget:H,staticExtradata:q,paymentToken:W,basePrice:D,extra:I,listingTime:M.listingTime,expirationTime:M.expirationTime,salt:i.WyvernProtocol.generatePseudoRandomSalt(),metadata:{asset:c,schema:e.name,referrerAddress:A}}]}}))}))},e.prototype._makeSellOrder=function(e){var t=e.asset,r=e.quantity,a=e.accountAddress,o=e.startAmount,c=e.endAmount,d=e.listingTime,u=e.expirationTime,l=e.waitForHighestBid,y=e.englishAuctionReservePrice,v=void 0===y?0:y,A=e.paymentTokenAddress,f=e.extraBountyBasisPoints,_=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,y,w,T,k,P,E,b,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q,K,G,z,Y,V,Z;return s(this,(function(s){switch(s.label){case 0:return a=m.validateAndFormatWalletAddress(this.web3,a),e=this._getSchema(t.schemaName),n=i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(r),t.decimals||0),y=m.getWyvernAsset(e,t,n),w=_!=g.NULL_ADDRESS,[4,this.api.getAsset(t)];case 1:return T=s.sent(),[4,this.computeFees({asset:T,side:h.OrderSide.Sell,isPrivate:w,extraBountyBasisPoints:f})];case 2:return k=s.sent(),P=k.totalSellerFeeBasisPoints,E=k.totalBuyerFeeBasisPoints,b=k.sellerBountyBasisPoints,S=p.encodeSell(e,y,a),N=S.target,F=S.calldata,R=S.replacementPattern,B=null!=c&&c!==o?h.SaleKind.DutchAuction:h.SaleKind.FixedPrice,[4,this._getPriceParameters(h.OrderSide.Sell,A,u,o,c,l,v)];case 3:return x=s.sent(),C=x.basePrice,O=x.extra,L=x.paymentToken,D=x.reservePrice,I=this._getTimeParameters(u,d,l),W=this._getSellFeeParameters(E,P,l,b),M=W.makerRelayerFee,U=W.takerRelayerFee,H=W.makerProtocolFee,q=W.takerProtocolFee,K=W.makerReferrerFee,G=W.feeRecipient,z=W.feeMethod,[4,this._getStaticCallTargetAndExtraData({asset:T,useTxnOriginStaticCall:l})];case 4:return Y=s.sent(),V=Y.staticTarget,Z=Y.staticExtradata,[2,{exchange:i.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:a,taker:_,quantity:n,makerRelayerFee:M,takerRelayerFee:U,makerProtocolFee:H,takerProtocolFee:q,makerReferrerFee:K,waitingForBestCounterOrder:l,englishAuctionReservePrice:D?m.makeBigNumber(D):void 0,feeMethod:z,feeRecipient:G,side:h.OrderSide.Sell,saleKind:B,target:N,howToCall:h.HowToCall.Call,calldata:F,replacementPattern:R,staticTarget:V,staticExtradata:Z,paymentToken:L,basePrice:C,extra:O,listingTime:I.listingTime,expirationTime:I.expirationTime,salt:i.WyvernProtocol.generatePseudoRandomSalt(),metadata:{asset:y,schema:e.name}}]}}))}))},e.prototype._getStaticCallTargetAndExtraData=function(e){var t=e.asset,r=e.useTxnOriginStaticCall;return n(this,void 0,void 0,(function(){var e,a,n,o,i,c,d,u,y;return s(this,(function(s){switch(s.label){case 0:return e=[g.CHEEZE_WIZARDS_GUILD_ADDRESS.toLowerCase(),g.CHEEZE_WIZARDS_GUILD_RINKEBY_ADDRESS.toLowerCase()].includes(t.tokenAddress.toLowerCase()),a=t.tokenAddress.toLowerCase()==g.DECENTRALAND_ESTATE_ADDRESS.toLowerCase(),(n=this._networkName==h.Network.Main)&&!r?[2,{staticTarget:g.NULL_ADDRESS,staticExtradata:"0x"}]:e?(o=n?g.CHEEZE_WIZARDS_BASIC_TOURNAMENT_ADDRESS:g.CHEEZE_WIZARDS_BASIC_TOURNAMENT_RINKEBY_ADDRESS,[4,this.web3.eth.contract(l.CheezeWizardsBasicTournament).at(o)]):[3,3];case 1:return i=s.sent(),[4,m.rawCall(this.web3,{to:i.address,data:i.wizardFingerprint.getData(t.tokenId)})];case 2:return c=s.sent(),[2,{staticTarget:n?g.STATIC_CALL_CHEEZE_WIZARDS_ADDRESS:g.STATIC_CALL_CHEEZE_WIZARDS_RINKEBY_ADDRESS,staticExtradata:p.encodeCall(l.getMethod(l.StaticCheckCheezeWizards,"succeedIfCurrentWizardFingerprintMatchesProvidedWizardFingerprint"),[t.tokenId,c,r])}];case 3:return a&&n?(d=g.DECENTRALAND_ESTATE_ADDRESS,[4,this.web3.eth.contract(l.DecentralandEstates).at(d)]):[3,6];case 4:return u=s.sent(),[4,m.rawCall(this.web3,{to:u.address,data:u.getFingerprint.getData(t.tokenId)})];case 5:return y=s.sent(),[2,{staticTarget:g.STATIC_CALL_DECENTRALAND_ESTATES_ADDRESS,staticExtradata:p.encodeCall(l.getMethod(l.StaticCheckDecentralandEstates,"succeedIfCurrentEstateFingerprintMatchesProvidedEstateFingerprint"),[t.tokenId,y,r])}];case 6:return r?[2,{staticTarget:n?g.STATIC_CALL_TX_ORIGIN_ADDRESS:g.STATIC_CALL_TX_ORIGIN_RINKEBY_ADDRESS,staticExtradata:p.encodeCall(l.getMethod(l.StaticCheckTxOrigin,"succeedIfTxOriginMatchesHardcodedAddress"),[])}]:[2,{staticTarget:g.NULL_ADDRESS,staticExtradata:"0x"}];case 7:return[2]}}))}))},e.prototype._makeBundleBuyOrder=function(e){var t=e.assets,r=e.collection,a=e.quantities,o=e.accountAddress,c=e.startAmount,d=e.expirationTime,u=void 0===d?0:d,l=e.paymentTokenAddress,y=e.extraBountyBasisPoints,v=void 0===y?0:y,A=e.sellOrder,f=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,d,y,_,w,T,k,P,E,b,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H=this;return s(this,(function(s){switch(s.label){case 0:return o=m.validateAndFormatWalletAddress(this.web3,o),e=a.map((function(e,r){return i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(e),t[r].decimals||0)})),n=m.getWyvernBundle(t,t.map((function(e){return H._getSchema(e.schemaName)})),e),d=n.schemas.map((function(e){return H._getSchema(e)})),y=A?A.maker:g.NULL_ADDRESS,r?[4,this.api.getAsset(t[0])]:[3,2];case 1:return w=s.sent(),[3,3];case 2:w=void 0,s.label=3;case 3:return _=w,[4,this.computeFees({asset:_,extraBountyBasisPoints:v,side:h.OrderSide.Buy})];case 4:return T=s.sent(),k=T.totalBuyerFeeBasisPoints,P=T.totalSellerFeeBasisPoints,E=this._getBuyFeeParameters(k,P,A),b=E.makerRelayerFee,S=E.takerRelayerFee,N=E.makerProtocolFee,F=E.takerProtocolFee,R=E.makerReferrerFee,B=E.feeRecipient,x=E.feeMethod,C=p.encodeAtomicizedBuy(d,n.assets,o,this._wyvernProtocol,this._networkName),O=C.calldata,L=C.replacementPattern,[4,this._getPriceParameters(h.OrderSide.Buy,l,u,c)];case 5:return D=s.sent(),I=D.basePrice,W=D.extra,M=D.paymentToken,U=this._getTimeParameters(u),[2,{exchange:i.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:o,taker:y,quantity:m.makeBigNumber(1),makerRelayerFee:b,takerRelayerFee:S,makerProtocolFee:N,takerProtocolFee:F,makerReferrerFee:R,waitingForBestCounterOrder:!1,feeMethod:x,feeRecipient:B,side:h.OrderSide.Buy,saleKind:h.SaleKind.FixedPrice,target:i.WyvernProtocol.getAtomicizerContractAddress(this._networkName),howToCall:h.HowToCall.DelegateCall,calldata:O,replacementPattern:L,staticTarget:g.NULL_ADDRESS,staticExtradata:"0x",paymentToken:M,basePrice:I,extra:W,listingTime:U.listingTime,expirationTime:U.expirationTime,salt:i.WyvernProtocol.generatePseudoRandomSalt(),metadata:{bundle:n,referrerAddress:f}}]}}))}))},e.prototype._makeBundleSellOrder=function(e){var t=e.bundleName,r=e.bundleDescription,a=e.bundleExternalLink,o=e.assets,c=e.collection,d=e.quantities,u=e.accountAddress,l=e.startAmount,y=e.endAmount,v=e.listingTime,A=e.expirationTime,f=e.waitForHighestBid,_=e.englishAuctionReservePrice,w=void 0===_?0:_,T=e.paymentTokenAddress,k=e.extraBountyBasisPoints,P=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,_,E,b,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q,K,G,z,Y,V,Z,X=this;return s(this,(function(s){switch(s.label){case 0:return u=m.validateAndFormatWalletAddress(this.web3,u),e=d.map((function(e,t){return i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(e),o[t].decimals||0)})),n=m.getWyvernBundle(o,o.map((function(e){return X._getSchema(e.schemaName)})),e),_=n.schemas.map((function(e){return X._getSchema(e)})),n.name=t,n.description=r,n.external_link=a,E=P!=g.NULL_ADDRESS,c?[4,this.api.getAsset(o[0])]:[3,2];case 1:return S=s.sent(),[3,3];case 2:S=void 0,s.label=3;case 3:return b=S,[4,this.computeFees({asset:b,side:h.OrderSide.Sell,isPrivate:E,extraBountyBasisPoints:k})];case 4:return N=s.sent(),F=N.totalSellerFeeBasisPoints,R=N.totalBuyerFeeBasisPoints,B=N.sellerBountyBasisPoints,x=p.encodeAtomicizedSell(_,n.assets,u,this._wyvernProtocol,this._networkName),C=x.calldata,O=x.replacementPattern,[4,this._getPriceParameters(h.OrderSide.Sell,T,A,l,y,f,w)];case 5:return L=s.sent(),D=L.basePrice,I=L.extra,W=L.paymentToken,M=L.reservePrice,U=this._getTimeParameters(A,v,f),H=null!=y&&y!==l?h.SaleKind.DutchAuction:h.SaleKind.FixedPrice,q=this._getSellFeeParameters(R,F,f,B),K=q.makerRelayerFee,G=q.takerRelayerFee,z=q.makerProtocolFee,Y=q.takerProtocolFee,V=q.makerReferrerFee,Z=q.feeRecipient,[2,{exchange:i.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:u,taker:P,quantity:m.makeBigNumber(1),makerRelayerFee:K,takerRelayerFee:G,makerProtocolFee:z,takerProtocolFee:Y,makerReferrerFee:V,waitingForBestCounterOrder:f,englishAuctionReservePrice:M?m.makeBigNumber(M):void 0,feeMethod:h.FeeMethod.SplitFee,feeRecipient:Z,side:h.OrderSide.Sell,saleKind:H,target:i.WyvernProtocol.getAtomicizerContractAddress(this._networkName),howToCall:h.HowToCall.DelegateCall,calldata:C,replacementPattern:O,staticTarget:g.NULL_ADDRESS,staticExtradata:"0x",paymentToken:W,basePrice:D,extra:I,listingTime:U.listingTime,expirationTime:U.expirationTime,salt:i.WyvernProtocol.generatePseudoRandomSalt(),metadata:{bundle:n}}]}}))}))},e.prototype._makeMatchingOrder=function(e){var t=this,r=e.order,n=e.accountAddress,s=e.recipientAddress;n=m.validateAndFormatWalletAddress(this.web3,n),s=m.validateAndFormatWalletAddress(this.web3,s);var o=function(){if("asset"in r.metadata){var e=t._getSchema(r.metadata.schema);return r.side==h.OrderSide.Buy?p.encodeSell(e,r.metadata.asset,s):p.encodeBuy(e,r.metadata.asset,s)}if("bundle"in r.metadata){var a=r.metadata.bundle,n=a.schemas?a.schemas.map((function(e){return t._getSchema(e)})):a.assets.map((function(){return t._getSchema("schema"in r.metadata?r.metadata.schema:void 0)})),o=r.side==h.OrderSide.Buy?p.encodeAtomicizedSell(n,r.metadata.bundle.assets,s,t._wyvernProtocol,t._networkName):p.encodeAtomicizedBuy(n,r.metadata.bundle.assets,s,t._wyvernProtocol,t._networkName);return{target:i.WyvernProtocol.getAtomicizerContractAddress(t._networkName),calldata:o.calldata,replacementPattern:o.replacementPattern}}throw new Error("Invalid order metadata")}(),c=o.target,d=o.calldata,u=o.replacementPattern,l=this._getTimeParameters(0),y=r.feeRecipient==g.NULL_ADDRESS?g.OPENSEA_FEE_RECIPIENT:g.NULL_ADDRESS,v={exchange:r.exchange,maker:n,taker:r.maker,quantity:r.quantity,makerRelayerFee:r.makerRelayerFee,takerRelayerFee:r.takerRelayerFee,makerProtocolFee:r.makerProtocolFee,takerProtocolFee:r.takerProtocolFee,makerReferrerFee:r.makerReferrerFee,waitingForBestCounterOrder:!1,feeMethod:r.feeMethod,feeRecipient:y,side:(r.side+1)%2,saleKind:h.SaleKind.FixedPrice,target:c,howToCall:r.howToCall,calldata:d,replacementPattern:u,staticTarget:g.NULL_ADDRESS,staticExtradata:"0x",paymentToken:r.paymentToken,basePrice:r.basePrice,extra:m.makeBigNumber(0),listingTime:l.listingTime,expirationTime:l.expirationTime,salt:i.WyvernProtocol.generatePseudoRandomSalt(),metadata:r.metadata};return a({},v,{hash:m.getOrderHash(v)})},e.prototype._validateMatch=function(e,t){var r=e.buy,a=e.sell,o=e.accountAddress,i=e.shouldValidateBuy,c=void 0!==i&&i,d=e.shouldValidateSell,u=void 0!==d&&d;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,i,d,l;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,7,,10]),c?[4,this._validateOrder(r)]:[3,2];case 1:if(e=s.sent(),this.logger("Buy order is valid: "+e),!e)throw new Error("Invalid buy order. It may have recently been removed. Please refresh the page and try again!");s.label=2;case 2:return u?[4,this._validateOrder(a)]:[3,4];case 3:if(n=s.sent(),this.logger("Sell order is valid: "+n),!n)throw new Error("Invalid sell order. It may have recently been removed. Please refresh the page and try again!");s.label=4;case 4:return[4,y.requireOrdersCanMatch(this._getClientsForRead(t).wyvernProtocol,{buy:r,sell:a,accountAddress:o})];case 5:return i=s.sent(),this.logger("Orders matching: "+i),[4,y.requireOrderCalldataCanMatch(this._getClientsForRead(t).wyvernProtocol,{buy:r,sell:a})];case 6:return d=s.sent(),this.logger("Order calldata matching: "+d),[2,!0];case 7:if(l=s.sent(),t<=0)throw new Error("Error matching this listing: "+l.message+". Please contact the maker or try again later!");return[4,m.delay(500)];case 8:return s.sent(),[4,this._validateMatch({buy:r,sell:a,accountAddress:o,shouldValidateBuy:c,shouldValidateSell:u},t-1)];case 9:return[2,s.sent()];case 10:return[2]}}))}))},e.prototype._createEmailWhitelistEntry=function(e){var t=e.order,r=e.buyerEmail;return n(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:if(!(e="asset"in t.metadata?t.metadata.asset:void 0)||!e.id)throw new Error("Whitelisting only available for non-fungible assets.");return[4,this.api.postAssetWhitelist(e.address,e.id,r)];case 1:return a.sent(),[2]}}))}))},e.prototype._sellOrderValidationAndApprovals=function(e){var t=e.order,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o;return s(this,(function(s){switch(s.label){case 0:return e="bundle"in t.metadata?t.metadata.bundle.assets:t.metadata.asset?[t.metadata.asset]:[],a="bundle"in t.metadata&&"schemas"in t.metadata.bundle?t.metadata.bundle.schemas:"schema"in t.metadata?[t.metadata.schema]:[],n=t.paymentToken,[4,this._approveAll({schemaNames:a,wyAssets:e,accountAddress:r})];case 1:return s.sent(),n==g.NULL_ADDRESS?[3,3]:(o=m.makeBigNumber(t.basePrice),[4,this.approveFungibleToken({accountAddress:r,tokenAddress:n,minimumAmount:o})]);case 2:s.sent(),s.label=3;case 3:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrderParameters_.callAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,{from:r})];case 4:if(!s.sent())throw console.error(t),new Error("Failed to validate sell order parameters. Make sure you're on the right network!");return[2]}}))}))},e.prototype._approveOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a,o=this;return s(this,(function(i){switch(i.label){case 0:return t=e.maker,[4,this._computeGasPrice()];case 1:return r=i.sent(),!0,this._dispatch(h.EventType.ApproveOrder,{order:e,accountAddress:t}),[4,this._wyvernProtocol.wyvernExchange.approveOrder_.sendTransactionAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata,true,{from:t,gasPrice:r})];case 2:return a=i.sent(),[4,this._confirmTransaction(a.toString(),h.EventType.ApproveOrder,"Approving order",(function(){return n(o,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._validateOrder(e)];case 1:return[2,t.sent()]}}))}))}))];case 3:return i.sent(),[2,a]}}))}))},e.prototype._validateOrder=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrder_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata,e.v||0,e.r||g.NULL_BLOCK_HASH,e.s||g.NULL_BLOCK_HASH)];case 1:return[2,t.sent()]}}))}))},e.prototype._approveAll=function(e){var t=e.schemaNames,r=e.wyAssets,a=e.accountAddress,o=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,i,c=this;return s(this,(function(d){switch(d.label){case 0:return(e=o)?[3,2]:[4,this._getProxy(a)];case 1:e=d.sent(),d.label=2;case 2:return(o=e||void 0)?[3,4]:[4,this._initializeProxy(a)];case 3:o=d.sent(),d.label=4;case 4:return i=new Set,[2,Promise.all(r.map((function(e,r){return n(c,void 0,void 0,(function(){var n,c,d,u,l;return s(this,(function(s){switch(s.label){case 0:n=t[r],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._ownsAssetOnChain({accountAddress:a,proxyAddress:o,wyAsset:e,schemaName:n})];case 2:return c=s.sent(),[3,4];case 3:return s.sent(),c=!0,[3,4];case 4:if(!c)throw d="quantity"in e?e.quantity:1,console.error("Failed on-chain ownership check: "+a+" on "+n+":",e),new Error("You don't own enough to do that ("+d+" base units of "+e.address+(e.id?" token "+e.id:"")+")");switch(n){case h.WyvernSchemaName.ERC721:case h.WyvernSchemaName.ERC1155:case h.WyvernSchemaName.LegacyEnjin:case h.WyvernSchemaName.ENSShortNameAuction:return[3,5];case h.WyvernSchemaName.ERC20:return[3,7]}return[3,9];case 5:return u=e,[4,this.approveSemiOrNonFungibleToken({tokenId:u.id.toString(),tokenAddress:u.address,accountAddress:a,proxyAddress:o,schemaName:n,skipApproveAllIfTokenAddressIn:i})];case 6:return[2,s.sent()];case 7:return l=e,i.has(l.address)?[2,null]:(i.add(l.address),[4,this.approveFungibleToken({tokenAddress:l.address,accountAddress:a,proxyAddress:o})]);case 8:return[2,s.sent()];case 9:return[2]}}))}))})))]}}))}))},e.prototype._buyOrderValidationAndApprovals=function(e){var t=e.order,r=e.counterOrder,a=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n,o;return s(this,(function(s){switch(s.label){case 0:return(e=t.paymentToken)==g.NULL_ADDRESS?[3,5]:[4,this.getTokenBalance({accountAddress:a,tokenAddress:e})];case 1:return n=s.sent(),o=m.makeBigNumber(t.basePrice),r?[4,this._getRequiredAmountForTakingSellOrder(r)]:[3,3];case 2:o=s.sent(),s.label=3;case 3:if(n.toNumber()<o.toNumber())throw e==c.tokens[this._networkName].canonicalWrappedEther.address?new Error("Insufficient balance. You may need to wrap Ether."):new Error("Insufficient balance.");return[4,this.approveFungibleToken({accountAddress:a,tokenAddress:e,minimumAmount:o})];case 4:s.sent(),s.label=5;case 5:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrderParameters_.callAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,{from:a})];case 6:if(!s.sent())throw console.error(t),new Error("Failed to validate buy order parameters. Make sure you're on the right network!");return[2]}}))}))},e.prototype._ownsAssetOnChain=function(e){var t=e.accountAddress,r=e.proxyAddress,a=e.wyAsset,o=e.schemaName;return n(this,void 0,void 0,(function(){var e,n,i;return s(this,(function(s){switch(s.label){case 0:return e={tokenId:a.id||null,tokenAddress:a.address,schemaName:o},n=new v.BigNumber("quantity"in a?a.quantity:1),[4,this.getAssetBalance({accountAddress:t,asset:e})];case 1:return s.sent().greaterThanOrEqualTo(n)?[2,!0]:(i=r)?[3,3]:[4,this._getProxy(t)];case 2:i=s.sent(),s.label=3;case 3:return(r=i)?[4,this.getAssetBalance({accountAddress:r,asset:e})]:[3,5];case 4:if(s.sent().greaterThanOrEqualTo(n))return[2,!0];s.label=5;case 5:return[2,!1]}}))}))},e.prototype._getBuyFeeParameters=function(e,t,r){var a,n;return this._validateFees(e,t),r?(a=r.waitingForBestCounterOrder?m.makeBigNumber(r.makerRelayerFee):m.makeBigNumber(r.takerRelayerFee),n=r.waitingForBestCounterOrder?m.makeBigNumber(r.takerRelayerFee):m.makeBigNumber(r.makerRelayerFee)):(a=m.makeBigNumber(e),n=m.makeBigNumber(t)),{makerRelayerFee:a,takerRelayerFee:n,makerProtocolFee:m.makeBigNumber(0),takerProtocolFee:m.makeBigNumber(0),makerReferrerFee:m.makeBigNumber(0),feeRecipient:g.OPENSEA_FEE_RECIPIENT,feeMethod:h.FeeMethod.SplitFee}},e.prototype._getSellFeeParameters=function(e,t,r,a){void 0===a&&(a=0),this._validateFees(e,t);var n=r?g.NULL_ADDRESS:g.OPENSEA_FEE_RECIPIENT;return{makerRelayerFee:r?m.makeBigNumber(e):m.makeBigNumber(t),takerRelayerFee:r?m.makeBigNumber(t):m.makeBigNumber(e),makerProtocolFee:m.makeBigNumber(0),takerProtocolFee:m.makeBigNumber(0),makerReferrerFee:m.makeBigNumber(a),feeRecipient:n,feeMethod:h.FeeMethod.SplitFee}},e.prototype._validateFees=function(e,t){var r=g.INVERSE_BASIS_POINT/100;if(e>g.INVERSE_BASIS_POINT||t>g.INVERSE_BASIS_POINT)throw new Error("Invalid buyer/seller fees: must be less than "+r+"%");if(e<0||t<0)throw new Error("Invalid buyer/seller fees: must be at least 0%")},e.prototype._getTimeParameters=function(e,t,r){void 0===r&&(r=!1);var a=Math.round(Date.now()/1e3+g.MIN_EXPIRATION_SECONDS),n=Math.round(Date.now()/1e3);if(0!=e&&e<a)throw new Error("Expiration time must be at least "+g.MIN_EXPIRATION_SECONDS+" seconds from now, or zero (non-expiring).");if(t&&t<n)throw new Error("Listing time cannot be in the past.");if(t&&0!=e&&t>=e)throw new Error("Listing time must be before the expiration time.");if(r&&0==e)throw new Error("English auctions must have an expiration time.");if(r&&t)throw new Error("Cannot schedule an English auction for the future.");if(parseInt(e.toString())!=e)throw new Error("Expiration timestamp must be a whole number of seconds");return r?(t=e,e+=g.ORDER_MATCHING_LATENCY_SECONDS):t=t||Math.round(Date.now()/1e3-100),{listingTime:m.makeBigNumber(t),expirationTime:m.makeBigNumber(e)}},e.prototype._getPriceParameters=function(e,t,r,a,o,c,d){return void 0===c&&(c=!1),n(this,void 0,void 0,(function(){var n,u,l,p,y,v,A,f;return s(this,(function(s){switch(s.label){case 0:return n=null!=o?a-o:0,u=t.toLowerCase(),l=t==g.NULL_ADDRESS,[4,this.api.getPaymentTokens({address:u})];case 1:if(p=s.sent().tokens,y=p[0],isNaN(a)||null==a||a<0)throw new Error("Starting price must be a number >= 0");if(!l&&!y)throw new Error("No ERC-20 token found for '"+u+"'");if(l&&c)throw new Error("English auctions must use wrapped ETH or an ERC-20 token.");if(l&&e===h.OrderSide.Buy)throw new Error("Offers must use wrapped ETH or an ERC-20 token.");if(n<0)throw new Error("End price must be less than or equal to the start price.");if(n>0&&0==r)throw new Error("Expiration time must be set if order will change in price.");if(d&&!c)throw new Error("Reserve prices may only be set on English auctions.");if(d&&d<a)throw new Error("Reserve price must be greater than or equal to the start amount.");return v=l?m.makeBigNumber(this.web3.toWei(a,"ether")).round():i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(a),y.decimals),A=l?m.makeBigNumber(this.web3.toWei(n,"ether")).round():i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(n),y.decimals),f=d?l?m.makeBigNumber(this.web3.toWei(d,"ether")).round():i.WyvernProtocol.toBaseUnitAmount(m.makeBigNumber(d),y.decimals):void 0,[2,{basePrice:v,extra:A,paymentToken:u,reservePrice:f}]}}))}))},e.prototype._getMetadata=function(e,t){var r=t||e.metadata.referrerAddress;if(r&&f.isValidAddress(r))return r},e.prototype._atomicMatch=function(e){var t=e.buy,r=e.sell,a=e.accountAddress,o=e.metadata,i=void 0===o?g.NULL_BLOCK_HASH:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,m,p,v;return s(this,(function(s){switch(s.label){case 0:return n=!0,o=!0,r.maker.toLowerCase()!=a.toLowerCase()?[3,2]:[4,this._sellOrderValidationAndApprovals({order:r,accountAddress:a})];case 1:return s.sent(),o=!1,[3,6];case 2:return t.maker.toLowerCase()!=a.toLowerCase()?[3,6]:[4,this._buyOrderValidationAndApprovals({order:t,counterOrder:r,accountAddress:a})];case 3:return s.sent(),n=!1,t.paymentToken!=g.NULL_ADDRESS?[3,5]:[4,this._getRequiredAmountForTakingSellOrder(r)];case 4:e=s.sent(),s.label=5;case 5:return[3,6];case 6:return[4,this._validateMatch({buy:t,sell:r,accountAddress:a,shouldValidateBuy:n,shouldValidateSell:o})];case 7:s.sent(),this._dispatch(h.EventType.MatchOrders,{buy:t,sell:r,accountAddress:a,matchMetadata:i}),d={from:a,value:e},u=[[t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken,r.exchange,r.maker,r.taker,r.feeRecipient,r.target,r.staticTarget,r.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt,r.makerRelayerFee,r.takerRelayerFee,r.makerProtocolFee,r.takerProtocolFee,r.basePrice,r.extra,r.listingTime,r.expirationTime,r.salt],[t.feeMethod,t.side,t.saleKind,t.howToCall,r.feeMethod,r.side,r.saleKind,r.howToCall],t.calldata,r.calldata,t.replacementPattern,r.replacementPattern,t.staticExtradata,r.staticExtradata,[t.v||0,r.v||0],[t.r||g.NULL_BLOCK_HASH,t.s||g.NULL_BLOCK_HASH,r.r||g.NULL_BLOCK_HASH,r.s||g.NULL_BLOCK_HASH,i]],s.label=8;case 8:return s.trys.push([8,11,,12]),[4,this._wyvernProtocolReadOnly.wyvernExchange.atomicMatch_.estimateGasAsync(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],d)];case 9:return l=s.sent(),m=d,[4,this._computeGasPrice()];case 10:return m.gasPrice=s.sent(),d.gas=this._correctGasAmount(l),[3,12];case 11:throw p=s.sent(),console.error("Failed atomic match with args: ",u,p),new Error('Oops, the Ethereum network rejected this transaction :( The OpenSea devs have been alerted, but this problem is typically due an item being locked or untransferrable. The exact error was "'+p.message.substr(0,y.MAX_ERROR_LENGTH)+'..."');case 12:return s.trys.push([12,14,,15]),this.logger("Fulfilling order with gas set to "+d.gas),[4,this._wyvernProtocol.wyvernExchange.atomicMatch_.sendTransactionAsync(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],d)];case 13:return c=s.sent(),[3,15];case 14:throw v=s.sent(),console.error(v),this._dispatch(h.EventType.TransactionDenied,{error:v,buy:t,sell:r,accountAddress:a,matchMetadata:i}),new Error('Failed to authorize transaction: "'+(v.message?v.message:"user denied")+'..."');case 15:return[2,c]}}))}))},e.prototype._getRequiredAmountForTakingSellOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a,n;return s(this,(function(s){switch(s.label){case 0:return[4,this.getCurrentPrice(e)];case 1:return t=s.sent(),r=m.estimateCurrentPrice(e),a=v.BigNumber.max(t,r),e.takerRelayerFee=m.makeBigNumber(e.takerRelayerFee),n=e.takerRelayerFee.div(g.INVERSE_BASIS_POINT),[2,n.times(a).plus(a).ceil()]}}))}))},e.prototype._authorizeOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a,n;return s(this,(function(s){switch(s.label){case 0:return t=e.hash,r=e.maker,this._dispatch(h.EventType.CreateOrder,{order:e,accountAddress:e.maker}),[4,m.isContractAddress(this.web3,r)];case 1:a=s.sent(),s.label=2;case 2:return s.trys.push([2,7,,8]),a?[4,this._approveOrder(e)]:[3,4];case 3:return s.sent(),[2,null];case 4:return[4,m.personalSignAsync(this.web3,t,r)];case 5:return[2,s.sent()];case 6:return[3,8];case 7:throw n=s.sent(),this._dispatch(h.EventType.OrderDenied,{order:e,accountAddress:r}),n;case 8:return[2]}}))}))},e.prototype._getSchema=function(e){var t=e||h.WyvernSchemaName.ERC721,r=c.schemas[this._networkName].filter((function(e){return e.name==t}))[0];if(!r)throw new Error("Trading for this asset ("+t+") is not yet supported. Please contact us or check back later!");return r},e.prototype._dispatch=function(e,t){this._emitter.emit(e,t)},e.prototype._getClientsForRead=function(e){return void 0===e&&(e=1),e>0?{web3:this.web3,wyvernProtocol:this._wyvernProtocol}:{web3:this.web3ReadOnly,wyvernProtocol:this._wyvernProtocolReadOnly}},e.prototype._confirmTransaction=function(e,t,r,o){return n(this,void 0,void 0,(function(){var n,i;return s(this,(function(s){switch(s.label){case 0:return n={transactionHash:e,event:t},this.logger("Transaction started: "+r),e!=g.NULL_BLOCK_HASH?[3,4]:(this._dispatch(h.EventType.TransactionCreated,{event:t}),o?[3,2]:(this.logger("Unknown action, waiting 1 minute: "+r),[4,m.delay(6e4)]));case 1:return s.sent(),[2];case 2:return[4,this._pollCallbackForConfirmation(t,r,o)];case 3:return[2,s.sent()];case 4:return s.trys.push([4,6,,7]),this._dispatch(h.EventType.TransactionCreated,n),[4,m.confirmTransaction(this.web3,e)];case 5:return s.sent(),this.logger("Transaction succeeded: "+r),this._dispatch(h.EventType.TransactionConfirmed,n),[3,7];case 6:throw i=s.sent(),this.logger("Transaction failed: "+r),this._dispatch(h.EventType.TransactionFailed,a({},n,{error:i})),i;case 7:return[2]}}))}))},e.prototype._pollCallbackForConfirmation=function(e,t,r){return n(this,void 0,void 0,(function(){var a=this;return s(this,(function(o){return[2,new Promise((function(o,i){return n(a,void 0,void 0,(function(){var a,c=this;return s(this,(function(d){return 60,[2,(a=function(d){return n(c,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,r()];case 1:return n.sent()?(this.logger("Transaction succeeded: "+t),this._dispatch(h.EventType.TransactionConfirmed,{event:e}),[2,o()]):d<=0?[2,i()]:(d%10==0&&this.logger("Tested transaction "+(60-d+1)+" times: "+t),[4,m.delay(5e3)]);case 2:return n.sent(),[2,a(d-1)]}}))}))})(60)]}))}))}))]}))}))},e}();t.OpenSeaPort=_}}]);
//# sourceMappingURL=35270ec8.aff521c3043b9a660eb0.js.map